<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anki Doom Scrolling App</title>
  <style>
    /* Global styles */
    body {
      font-family: Arial, sans-serif;
      background-color: #0d0d0d;
      color: #ffffff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }
    h2 {
      color: #00ffcc;
      text-shadow: 0 0 10px #00ffcc;
      text-align: center;
      margin: 20px;
    }
    /* Card container */
    #card-container {
      width: 100%;
      max-width: 600px;
      padding: 0 10px;
      box-sizing: border-box;
    }
    /* Card styles */
    .card {
      background: #1a1a1a;
      padding: 20px;
      margin: 10px 0;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 255, 204, 0.7);
      overflow-wrap: break-word;
    }
    .front,
    .back {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    /* Ensure images are responsive */
    img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 10px auto;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 255, 204, 0.5);
    }
    /* Cloze deletion styles */
    .cloze {
      color: #00ffcc;
      cursor: pointer;
      font-weight: bold;
      text-shadow: 0 0 10px #00ffcc;
      padding: 2px 4px;
      border: 1px dashed #00ffcc;
      border-radius: 4px;
    }
    .cloze-revealed {
      color: #00ffcc;
      text-shadow: 0 0 10px #00ffcc;
      padding: 2px 4px;
      border: 1px solid #00ffcc;
      border-radius: 4px;
    }
    /* Mobile adjustments */
    @media (max-width: 600px) {
      .front,
      .back {
        font-size: 1em;
      }
    }
  </style>
</head>
<body>
  <h2>Anki Doom Scrolling</h2>
  <div id="card-container"></div>

  <script>
    async function loadDeck() {
      try {
        const response = await fetch('anki_deck.txt');
        const text = await response.text();
        const lines = text.split('\n');

        // Filter out header lines (starting with '#') and empty lines.
        const validLines = lines.filter(line => line && !line.startsWith('#'));

        // Parse each valid line into an object with front and back properties.
        const deckCards = validLines
          .map(line => line.split('\t'))
          .filter(parts => parts.length >= 2)
          .map(parts => ({
            front: parts[0].trim(),
            back: parts[1].trim()
          }));

        // Define some dummy cards (they can also include cloze deletions).
        const dummyCards = [
          { front: "What is the capital of France?", back: "Paris 🇫🇷" },
          { front: "Solve: 2 + 2", back: "4️⃣" },
          {
            front: "Which animal is known as the king of the jungle?",
            back: "Lion 🦁"
          },
          {
            front: "What is the chemical symbol for water?",
            back: "H₂O 💧"
          },
          {
            front: "What planet is known as the Red Planet?",
            back: "Mars 🔴"
          },
          {
            front: "What is the square root of 16?",
            back: "4️⃣"
          },
          {
            front: "Which instrument has 88 keys?",
            back: "Piano 🎹"
          },
          {
            front: "Who painted the Mona Lisa?",
            back: "Leonardo da Vinci 🖼️"
          },
          {
            front: "What is the fastest land animal?",
            back: "Cheetah 🐆"
          },
          {
            front: "How many continents are there?",
            back: "7 🌍"
          },
          {
            front: "Who wrote 'Romeo and Juliet'?",
            back: "William Shakespeare 📜"
          },
          {
            front: "What gas do plants absorb from the atmosphere?",
            back: "Carbon dioxide 🌿"
          },
          {
            front: "What is the capital of Japan?",
            back: "Tokyo 🏯"
          },
          {
            front: "What is the chemical symbol for gold?",
            back: "Au 🏆"
          },
          {
            front: "What is the largest ocean?",
            back: "Pacific Ocean 🌊"
          },
          {
            front: "What is the smallest planet in the Solar System?",
            back: "Mercury 🪐"
          },
          {
            front: "How many legs does a spider have?",
            back: "8 🕷️"
          },
          {
            front: "Who discovered gravity?",
            back: "Isaac Newton 🍏"
          },
          {
            front: "What is the national bird of the United States?",
            back: "Bald Eagle 🦅"
          },
          {
            front: "What is the hardest natural substance on Earth?",
            back: "Diamond 💎"
          },
          {
            front: "Which gas is most abundant in Earth's atmosphere?",
            back: "Nitrogen 🌬️"
          },
          {
            front: "What is the main ingredient in sushi?",
            back: "Rice 🍣"
          },
          {
            front: "How many players are on a soccer team?",
            back: "11 ⚽"
          },
          {
            front: "What is the national flower of Japan?",
            back: "Cherry Blossom 🌸"
          },
          {
            front: "What is the tallest mountain in the world?",
            back: "Mount Everest 🏔️"
          },
          {
            front: "How many bones are in the adult human body?",
            back: "206 🦴"
          },
          {
            front: "What is the boiling point of water in Celsius?",
            back: "100°C 🌡️"
          },
          {
            front: "Which element has the atomic number 1?",
            back: "Hydrogen ⚛️"
          },
          {
            front: "What is the capital of Australia?",
            back: "Canberra 🇦🇺"
          }
        ];

        // Shuffle the deck cards for randomness.
        const shuffledDeck = shuffleArray(deckCards);

        // Combine dummy cards and deck cards.
        const allCards = [...dummyCards, ...shuffledDeck];
        displayCards(allCards);
      } catch (error) {
        console.error('Error loading deck:', error);
      }
    }

    function displayCards(cards) {
      const container = document.getElementById('card-container');
      cards.forEach(card => {
        const cardElement = document.createElement('div');
        cardElement.className = 'card';
        // Process both front and back for images and cloze deletions.
        const processedFront = processCloze(fixImagePaths(card.front));
        const processedBack = processCloze(fixImagePaths(card.back));
        cardElement.innerHTML = `
          <div class="front">${processedFront}</div>
          <div class="back">${processedBack}</div>
        `;
        container.appendChild(cardElement);
      });
      // Attach event listeners to cloze spans after the cards are in the DOM.
      attachClozeListeners();
    }

    // Fix image paths: remove outer quotes and replace extra quotes in src attributes.
    function fixImagePaths(html) {
      // Remove outer quotes if present (handles both " and ').
      if ((html.startsWith('"') && html.endsWith('"')) || (html.startsWith("'") && html.endsWith("'"))) {
        html = html.slice(1, -1);
      }
      // Replace occurrences of src=""..."" or src==''...'' with src="..."
      return html.replace(/src=["']{2,}(.*?)["']{2,}/g, 'src="$1"');
    }

    // Process cloze deletions.
    // Recognizes both simple cloze: {{c1::answer}}
    // and cloze with a hint: {{c1::answer::hint}}
    function processCloze(html) {
      return html.replace(/\{\{c\d+::(.*?)\}\}/g, function(match, content) {
        let parts = content.split('::');
        let answer, hint;
        if (parts.length === 1) {
          answer = parts[0].trim();
          hint = '...';
        } else {
          answer = parts[0].trim();
          hint = parts[1].trim();
        }
        // Return a span with a data-answer attribute (using JSON.stringify for proper escaping)
        return '<span class="cloze" data-answer=' + JSON.stringify(answer) + '>[' + hint + ']</span>';
      });
    }

    // Attach event listeners to all cloze spans to reveal the answer on click.
    function attachClozeListeners() {
      const clozeSpans = document.querySelectorAll('.cloze');
      clozeSpans.forEach(span => {
        span.addEventListener('click', function() {
          // Replace the clickable content with the answer
          this.innerHTML = this.dataset.answer;
          this.className = 'cloze-revealed';
        });
      });
    }

    // Simple shuffle algorithm.
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    document.addEventListener('DOMContentLoaded', loadDeck);
  </script>
</body>
</html>